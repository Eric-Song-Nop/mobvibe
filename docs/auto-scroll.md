# 自动滚动与输入配置修复

## 目标

- 修复会话切换后自动滚动的竞态问题，避免用户在浏览历史时被强制滚动。
- 去除硬编码魔数（自动滚动阈值、输入行数），改为集中配置。
- 补充自动滚动逻辑的单元测试。

## 计划

1. 盘点 `App.tsx` 现有自动滚动逻辑与输入配置。
2. 抽离可测试的自动滚动状态计算函数。
3. 引入集中配置常量并替换魔数。
4. 补充自动滚动状态的单元测试。

## 方案与架构

- 使用独立的自动滚动状态对象（`isAtBottom` / `hasUserScrolled` / `lastScrollTop`）统一管理滚动判断。
- 会话切换时重置用户滚动标记，但不强制覆盖用户的滚动行为。
- 新建 UI 配置常量文件，集中维护滚动阈值与输入行数。

## 实现记录

- 新增 `src/lib/auto-scroll.ts`，集中处理滚动状态更新与自动滚动判定逻辑。
- 在 `App.tsx` 里使用统一的滚动状态对象，避免会话切换后误触发自动滚动。
- 新增 `src/lib/ui-config.ts`，集中维护自动滚动阈值与输入行数配置。
- 新增 `tests/auto-scroll.test.ts` 覆盖滚动状态更新与自动滚动判定。
