# MVP 实施路线图

## 目标

- 交付一个可用的 ACP 聊天 WebUI MVP：支持通过后端连接本地 `opencode acp`，前端完成基础聊天体验与状态展示。
- 形成清晰的前后端边界与最小可扩展架构，为后续多 Agent/存储/插件化打基础。

## 已完成（来自现有记录）

- [x] 后端：已完成 `apps/server` 工程初始化、`opencode acp` 连接、健康检查与状态接口（详见 `docs/backend-server-setup.md`）。
- [x] 前端：已修复初始化渲染问题（`class`/`for` 属性与 React 去重）（详见 `docs/frontend-init-fix.md`）。
- [x] ACP：补充协议实现跟踪文档（详见 `docs/acp-protocol-implementation.md`）。

## MVP 范围

- 仅支持本地 `opencode acp` 连接，不包含多 Agent 路由。
- 具备最小聊天 UI、消息流展示与输入发送。
- 具备基础连接状态与错误提示。

## MVP 非目标

- 多用户/鉴权、云端部署、插件市场。
- 复杂的会话持久化与高级检索（可做简单本地存储）。
- 复杂的 UI 主题切换与高级配置页。

## 里程碑与任务拆解

### M1：后端 API 与 ACP 会话能力（基础可用）

- [x] 增加后端 API：创建会话、发送消息、拉取增量/流式响应。
- [ ] 统一 ACP 连接状态与错误模型，前端可消费。
- [ ] 确保 `opencode acp` 进程生命周期可控（断线重连、退出清理）。

### M2：前端聊天体验（可交互）

- [ ] 采用 Shadcn UI 组件搭建聊天布局与输入框。
- [ ] 使用 Streamdown 渲染消息内容。
- [ ] 集成 Tanstack Query + Zustand 管理消息与状态。
- [ ] 展示 ACP 连接状态、错误提示与重试入口。

### M3：最小持久化（增强）

- [ ] 引入 SQLite + Drizzle 保存会话与消息（仅必要字段）。
- [ ] 前端支持恢复最近会话与消息列表。

### M4：质量保障与稳定性

- [ ] 添加基础 API/组件测试（Vitest）。
- [ ] 关键路径验证：启动、连接、发送、断线重连。
- [ ] 统一错误码/错误提示文案。

## 关键接口草案（方向）

- [ ] `GET /health`：服务健康状态。
- [ ] `GET /acp/opencode`：连接状态、会话信息。
- [ ] `POST /acp/session`：创建新会话。
- [ ] `POST /acp/message`：发送消息（支持流式或轮询）。

## 风险与缓解

- React 多实例导致 Hook 错误：维持 `react`/`react-dom` 去重与依赖一致性。
- ACP 进程异常退出：增加重连策略与错误上报。
- 流式消息体验不稳定：先做轮询，后续再切流式。

## 验证清单（MVP 验收）

- [ ] 后端服务启动后可成功连接 `opencode acp`。
- [ ] 前端能创建会话、发送消息、接收回复。
- [ ] 断线后能提示并允许重连。
