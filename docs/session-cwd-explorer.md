# 会话工作目录选择器（Finder 风格）

## 实现前计划

### 目标

- 创建会话时允许用户选择工作目录（cwd），仅允许目录。
- 文件浏览器采用 Finder 风格横向列布局，移动端可横向滑动。
- 仅允许从 Home 目录开始浏览，输入路径与浏览路径都必须限制在 Home 内。
- 支持手动输入/粘贴路径，隐藏项可见。

### 后端方案

- 新增文件浏览接口：
  - `GET /fs/roots`：返回 Home 根信息。
  - `GET /fs/entries?path=...`：返回指定目录下的条目列表。
- 统一路径校验：
  - 以 `os.homedir()` 为根，拒绝所有解析后不在 Home 内的路径。
  - 使用 `realpath` 解析符号链接，避免绕过根目录限制。
- 返回结构包含 `name`、`path`、`type`（目录/文件）、`hidden` 等基础信息。

### 前端方案

- 创建会话弹窗加入工作目录选择器：
  - 顶部提供路径输入框（可手动输入/粘贴）。
  - 中部为横向滚动列视图，每列展示当前路径下的目录与文件。
  - 仅目录可点击选中，文件仅展示。
- 选中路径回填到创建会话请求 `cwd`。

### 交互与布局

- 移动端优先：列宽固定、横向滑动、点击目录进入下一列。
- 列表展示隐藏项（以 `.` 开头的目录/文件）。
- 选中目录高亮，顶部显示当前选中路径。

### 影响范围

- 后端：新增文件浏览 API、路径校验工具函数。
- 前端：新增 API 调用、文件选择器组件、创建会话弹窗扩展。
- 文档：补充实现后记录与使用说明。

## 实现后记录

### 后端实现

- 新增 `/fs/roots` 与 `/fs/entries` 接口，提供 Home 根路径与目录条目信息。
- 后端统一路径校验：仅允许 Home 内目录，解析符号链接后越界直接拒绝。
- `POST /acp/session` 在创建会话时校验 `cwd`，并使用解析后的真实路径。

### 前端实现

- 创建会话弹窗新增 Finder 风格文件选择器，横向列展示目录结构。
- 支持手动输入/粘贴路径并跳转，输入框同步显示当前选中目录。
- 仅目录可点击进入/选择，文件只展示不可选。
- 选择器默认定位到 Home 根目录，移动端支持横向滑动。
- 列视图区使用独立横向滚动容器，确保多列可左右滑动。
- 当前选中列自动保持在可视区域中部。
- 仅展示可进入的目录，不再显示文件条目。
- 每列目录列表固定高度并支持纵向滚动。

### 使用说明

- 打开“新建对话”弹窗，输入或选择工作目录后再创建会话。
- 若路径不在 Home 内或无权限，会提示错误并阻止创建。
