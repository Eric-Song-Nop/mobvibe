# UI 布局与滚动优化

## 目标

- 侧边栏与聊天区滚动互不影响，页面整体不再纵向滚动。
- 顶部状态栏在移动端精简信息，不再放置“新对话”入口。
- 输入区固定在底部，并兼容移动端安全区。

## 实现前计划（2026-01-15）

- 页面容器改为全高布局（`h-screen` + `overflow-hidden`）。
- 侧边栏：头部固定，列表区域 `overflow-y-auto` 独立滚动。
- 聊天区：消息列表 `flex-1 overflow-y-auto`，顶部状态栏与底部输入区不随消息滚动。
- 顶部状态栏：移动端隐藏多余徽章，仅保留核心状态展示。
- 输入区：使用底部固定布局与安全区 padding，避免遮挡。

## 结构与架构说明

- 布局层级：Root（全高） → Sidebar（桌面常驻/移动端抽屉） + Chat Content。
- Chat Content 由三段组成：Header（状态栏） + Main（消息滚动区） + Footer（固定输入区）。
- 滚动范围仅限 Sidebar 列表与消息列表，其他区域保持固定。
- 组件职责保持不变，仅调整容器与 Tailwind 布局策略。

## 实现后记录（2026-01-15）

- Root 容器使用 `h-screen` 与 `overflow-hidden`，主区域与侧边栏均启用 `min-h-0` 支持独立滚动。
- 侧边栏与移动端抽屉采用 `overflow-y-auto` 列表滚动，头部保持固定。
- 顶部状态栏移除“新对话”入口，移动端仅展示状态徽章，后端/Session 信息在桌面展示。
- 输入区在底部固定，并加入安全区 padding 避免遮挡。

## 使用说明

- 新建对话统一在侧边栏完成，移动端请先展开左侧菜单。
- 聊天消息在中间区域滚动，顶部状态与底部输入始终固定可见。
- 移动端 Model/Mode 使用图标按钮选择具体项。

## 移动端输入区紧凑优化

### 实现前计划（2026-01-15）

- 顶部状态栏移除品牌文案与 Session ID，仅保留状态徽章与后端名称。
- Agent 标签不再在输入区展示，后端信息集中到顶部。
- 输入区首行改为输入框 + 发送/停止并排，降低移动端纵向高度。
- Model/Mode 在移动端使用图标触发选择，桌面保留文字标签。
- 结构保持 Header + Main + Footer，Footer 拆分为输入行 + 控制行。

### 实现后记录（2026-01-15）

- 顶部状态栏仅保留状态徽章与后端名称，移除品牌与 Session 信息。
- 输入区改为输入框 + 发送/停止并排，Textarea 行数减少为 2 行。
- Model/Mode 控件移动端显示图标触发，桌面继续展示文字。
- 输入区元信息集中到第二行，发送中提示靠右展示。

## 移动端选择器与消息滚动优化

### 实现前计划（2026-01-15）

- 调整移动端 Model/Mode 触发器宽度与对齐，确保图标与下拉箭头被边框包裹。
- 消息列表新增条件自动滚动：切换会话、刷新或新消息到达时滚到最新。
- 当用户滚动离底部超过 80px 时，暂停自动滚动避免打断阅读。

### 实现后记录（2026-01-15）

- 移动端 Model/Mode 触发器宽度加大并居中对齐，边框完整包裹图标与箭头。
- 消息列表在切换会话/更新时自动滚到底部，用户上滑阅读时保持当前位置。
- 判断滚动方向，向上滚动才暂停自动滚动，向下滚动继续跟随。
- 自动滚动阈值设置为 80px，避免轻微滚动触发跳动。

## 移动端输入区单行布局

### 实现前计划（2026-01-15）

- 输入区在移动端压缩为单行布局，保持桌面端现有两行结构。
- 左侧固定 Model/Mode 控件为一列，右侧发送/停止按钮为一列。
- 输入框占据中间剩余宽度，移动端高度控制为单行。

### 实现后记录（2026-01-15）

- 移动端输入区改为单行排列：Model/Mode | 输入框 | 发送/停止。
- Model/Mode 与发送/停止均为纵向排列，桌面端保持原布局。
- 输入框在移动端限制为单行高度，避免占用垂直空间。

## 移动端视口高度修复

### 实现前计划（2026-01-16）

- 根容器高度从 `100vh` 调整为 `100dvh`，并保留 `100vh` 作为回退，避免地址栏导致可视高度偏差。
- 保持页面整体不滚动，仅消息列表 `overflow-y-auto` 承载信息流。
- Header/Footer 明确 `shrink-0` 固定高度，避免随滚动抖动。
- 结构维持 Header + Main + Footer，不引入新的布局层级。

### 实现后记录（2026-01-16）

- 根容器新增 `app-root` 类，使用 `100vh` + `100dvh` 组合高度，移动端以动态视口为准。
- Header 增加 `shrink-0`，保证顶部状态栏不随信息流滚动。
- 消息列表仍为唯一滚动区域，页面整体保持 `overflow-hidden`。
