* Mobvibe

Mobvibe 是一个分布式 ACP（Agent Client Protocol）WebUI，用于本地 Agent 工作流。它连接 ACP 兼容的 CLI（opencode、gemini-cli、claude-code），管理多会话对话，并在桌面和移动端提供快速、触控友好的体验。

** 主要功能

- 多会话聊天，支持实时流式更新
- 端到端加密（E2EE）— 会话内容在 CLI 端加密、WebUI 端解密，Gateway 无法读取内容
- 权限请求处理，内嵌决策卡片
- Slash 命令选择器（=/=）和文件资源选择器（=@=）
- 会话级文件浏览器，支持代码预览和 Tree-sitter 大纲
- 通过 Tauri v2 支持桌面和移动应用
- 浅色/深色/跟随系统主题，中英双语

** 架构

#+begin_src
┌─────────────────────────┐     Socket.io      ┌──────────────┐     Socket.io     ┌───────────────┐
│        webui            │◄──────────────────►│   gateway    │◄─────────────────►│  mobvibe-cli  │
│  (React + Tauri v2)     │    /webui ns       │  (Express)   │    /cli ns        │   (Bun CLI)   │
│  Web / Desktop / Mobile │                    └──────────────┘                   └───────┬───────┘
└─────────────────────────┘                           │                                   │
                                                 REST API                           stdin/stdout
                                                 (:3005)                                  │
                                                                                  ┌───────▼───────┐
                                                                                  │   ACP CLI     │
                                                                                  │ (claude-code) │
                                                                                  └───────────────┘
#+end_src

** 前置要求

- Node.js 18+（用于 gateway/webui）
- Bun 1.0+（用于 mobvibe-cli）
- pnpm（包管理器）
- ACP CLI 工具：=opencode=（默认）、=claude-code=、=codex=、=gemini-cli=，或其他 ACP 兼容 agent

** 快速开始

#+begin_src bash
# 克隆仓库
git clone https://github.com/anthropics/mobvibe.git
cd mobvibe

# 安装依赖
pnpm install

# 启动所有服务
pnpm dev
#+end_src

服务地址：
- Gateway: http://localhost:3005
- WebUI: http://localhost:5173

** CLI 使用

*** 安装

#+begin_src bash
# 从仓库运行
cd apps/mobvibe-cli
pnpm build
./bin/mobvibe.mjs start
#+end_src

*** 命令列表

| 命令                              | 说明                                 |
|-----------------------------------+--------------------------------------|
| =mobvibe login=                    | 认证并生成 E2EE 主密钥              |
| =mobvibe logout=                   | 清除认证凭据                         |
| =mobvibe auth-status=              | 查看认证状态                         |
| =mobvibe start [--gateway <url>]=  | 启动守护进程                         |
| =mobvibe stop=                     | 停止守护进程                         |
| =mobvibe status=                   | 查看守护进程状态                     |
| =mobvibe logs [-f] [-n <lines>]=   | 查看守护进程日志                     |
| =mobvibe e2ee show=                | 显示主密钥（用于 WebUI 配对）       |
| =mobvibe e2ee status=              | 查看 E2EE 密钥状态                  |

*** 配置

| 变量                    | 说明                                     |
|-------------------------+------------------------------------------|
| =MOBVIBE_GATEWAY_URL=    | Gateway URL（默认: http://localhost:3005）|
| =MOBVIBE_HOME=           | CLI 家目录（默认: ~/.mobvibe）           |

*** ACP Agents

Mobvibe 从 =${MOBVIBE_HOME:-~/.mobvibe}/.config.json= 加载 agent 定义。

- =agents=：对外暴露的 agent 列表。每项支持 =id=（必填）、=command=（必填）、=label=、=args=、=env=。
- =defaultAgentId=：可选，默认 agent 的 id。

行为：
- 未配置或 =agents= 为空时，使用内置 =opencode= 后端。
- 若配置了 =agents= 但没有 =opencode= 项，内置 =opencode= 会被自动添加到列表最前。
- 若配置了 =id: "opencode"=，则使用你的列表并覆盖内置默认。
- =defaultAgentId= 必须匹配现有 agent id。

#+begin_src json
{
  "agents": [
    {
      "id": "opencode",
      "label": "OpenCode",
      "command": "opencode",
      "args": ["acp"]
    }
  ],
  "defaultAgentId": "opencode"
}
#+end_src

**** OpenCode（默认）

- 安装 OpenCode 并确保 =opencode= 在 PATH：[[https://github.com/sst/opencode][https://github.com/sst/opencode]]
- 默认执行 =opencode acp=。只有需要自定义参数或环境变量时才需要显式添加 =opencode=。

**** Claude Code（通过 Zed 适配器）

- 安装：=pnpm add -g @zed-industries/claude-code-acp=
- 确保提供 =ANTHROPIC_API_KEY=（或在 =env= 中注入）。

#+begin_src json
{
  "agents": [
    {
      "id": "claude-code",
      "label": "Claude Code",
      "command": "claude-code-acp",
      "env": {
        "ANTHROPIC_API_KEY": "<your-key>"
      }
    }
  ],
  "defaultAgentId": "claude-code"
}
#+end_src

**** Codex（通过 Zed 适配器）

- 从 releases 安装或 =pnpm dlx @zed-industries/codex-acp=，并确保 =codex-acp= 在 PATH：[[https://github.com/zed-industries/codex-acp][https://github.com/zed-industries/codex-acp]]
- 提供 =OPENAI_API_KEY=（或 =CODEX_API_KEY=）。

#+begin_src json
{
  "agents": [
    {
      "id": "codex",
      "label": "Codex",
      "command": "codex-acp",
      "env": {
        "OPENAI_API_KEY": "<your-key>"
      }
    }
  ],
  "defaultAgentId": "codex"
}
#+end_src

** 支持的 ACP Agents

文档索引：https://agentclientprotocol.com/llms.txt

以下 agent 可用于 ACP Client：

- [[https://phil65.github.io/agentpool/advanced/acp-integration/][AgentPool]]
- [[https://docs.augmentcode.com/cli/acp][Augment Code]]
- [[https://docs.blackbox.ai/features/blackbox-cli/introduction][Blackbox AI]]
- [[https://docs.anthropic.com/en/docs/claude-code/overview][Claude Code]]（通过 [[https://github.com/zed-industries/claude-code-acp][Zed 适配器]]）
- [[https://developers.openai.com/codex/cli][Codex CLI]]（通过 [[https://github.com/zed-industries/codex-acp][Zed 适配器]]）
- [[https://github.com/stippi/code-assistant?tab=readme-ov-file#configuration][Code Assistant]]
- [[https://github.com/docker/cagent][Docker's cagent]]
- [[https://fast-agent.ai/acp][fast-agent]]
- [[https://github.com/google-gemini/gemini-cli][Gemini CLI]]
- [[https://block.github.io/goose/docs/guides/acp-clients][Goose]]
- [[https://www.jetbrains.com/junie/][JetBrains Junie（即将推出）]]
- [[https://github.com/MoonshotAI/kimi-cli][Kimi CLI]]
- [[https://github.com/femto/minion-code][Minion Code]]
- [[https://github.com/mistralai/mistral-vibe][Mistral Vibe]]
- [[https://github.com/sst/opencode][OpenCode]]
- [[https://docs.openhands.dev/openhands/usage/run-openhands/acp][OpenHands]]
- [[https://github.com/badlogic/pi-mono/tree/main/packages/coding-agent][Pi]]（通过 [[https://github.com/svkozak/pi-acp][pi-acp 适配器]]）
- [[https://docs.qoder.com/cli/acp][Qoder CLI]]
- [[https://github.com/QwenLM/qwen-code][Qwen Code]]
- [[https://github.com/stakpak/agent?tab=readme-ov-file#agent-client-protocol-acp][Stakpak]]
- [[https://github.com/vinhnx/vtcode/blob/main/README.md#zed-ide-integration-agent-client-protocol][VT Code]]

** E2EE 配置

*** 1. 登录（CLI）

#+begin_src bash
mobvibe login
#+end_src

输入邮箱和密码。完成后会生成主密钥并注册设备。主密钥会显示在终端 — 复制它用于第 2 步。

*** 2. 配对 WebUI

打开 WebUI → 设置 → 端到端加密 → 粘贴主密钥 → 点击「配对」。

之后可用 =mobvibe e2ee show= 再次查看主密钥。

*** 3. 启动守护进程

#+begin_src bash
mobvibe start
#+end_src

所有会话内容现已端到端加密。Gateway 只负责路由，无法读取内容。

** WebUI 使用

*** Web 模式

#+begin_src bash
cd apps/webui
pnpm dev
#+end_src

访问地址：http://localhost:5173

*** 桌面模式 (Tauri)

#+begin_src bash
cd apps/webui
pnpm dev:tauri    # 开发
pnpm build:tauri  # 生产构建
#+end_src

输出：=.msi=、=.exe=（Windows），=.app=、=.dmg=（macOS），=.deb=、=.AppImage=（Linux）

*** 移动端模式 (Tauri)

#+begin_src bash
# Android（需要 Android SDK）
cd apps/webui
pnpm android:init   # 首次运行
pnpm android:dev    # 开发

# iOS（仅 macOS，需要 Xcode）
pnpm ios:init       # 首次运行
pnpm ios:dev        # 开发
#+end_src

*** 环境变量

| 变量                | 说明                                 |
|---------------------+--------------------------------------|
| =VITE_GATEWAY_URL=   | Gateway URL（未设置时自动检测）       |

** 开发

*** 脚本

| 命令          | 说明               |
|---------------+--------------------|
| =pnpm dev=     | 启动所有包         |
| =pnpm build=   | 构建所有包         |
| =pnpm lint=    | Biome lint         |
| =pnpm format=  | Biome 格式化       |
| =pnpm test=    | 运行测试（Vitest） |

*** 代码风格

- 格式化：Biome（Tab 缩进，双引号）
- TypeScript：严格模式

** 部署

参见 [[file:docs/deploy-railway-netlify.md][docs/deploy-railway-netlify.md]] 了解 Railway + Netlify 部署指南。

** 文档

- ACP 协议：https://agentclientprotocol.com/
- ACP TypeScript SDK：https://agentclientprotocol.github.io/typescript-sdk/
